# Use Case – Оплата покупки с начислением баллов

## Название
Клиент оплачивает покупку в офлайн-магазине и получает баллы лояльности.

## Акторы
- Основной: Клиент мобильного приложения FortePay  
- Внешние: Merchant, Loyalty Engine, Processing Center

## Предусловия
- Клиент авторизован в мобильном приложении.  
- У клиента есть активная карта FortePay, подключенная к программе лояльности.  

## Основной поток
1. Клиент совершает покупку картой FortePay.  
2. Процессинг подтверждает транзакцию и передаёт данные в Loyalty Engine.  
3. Loyalty Engine рассчитывает баллы на основе MCC-кода и суммы.  
4. Баллы зачисляются на счёт клиента и отправляется push-уведомление.  
5. Приложение обновляет историю транзакций и баланс баллов.  

## Альтернативные потоки
- **Недостаточно средств:** процессинг возвращает отказ, начисление не происходит, клиент получает уведомление.  
- **Временная недоступность Loyalty Engine:** данные ставятся в очередь, клиент получает баллы после восстановления сервиса.  

## Постусловия
- Баллы отражаются в профиле клиента.  
- История операции видна в разделе “Лояльность”.
